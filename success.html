<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Order Success - Classic Decor</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <a href="index.html" class="logo-text">Classic Decor</a>
      </div>
      <nav>
        <ul></ul>
      </nav>
      <div class="header-actions">
        <a href="shop.html" class="icon-btn" title="Shop"
          ><i class="fa-solid fa-store"></i
        ></a>
        <a href="#" id="search-toggle" class="icon-btn" title="Search"
          ><i class="fa-solid fa-magnifying-glass"></i
        ></a>
        <a href="login.html" class="icon-btn" title="Account"
          ><i class="fa-regular fa-user"></i
        ></a>
        <a href="cart.html" class="icon-btn" title="Cart"
          ><i class="fa-solid fa-cart-shopping"></i
          ><span id="nav-cart-count">0</span></a
        >
      </div>
    </header>
    <div id="search-overlay" class="search-overlay" aria-hidden="true">
      <div class="search-panel">
        <button
          id="search-close"
          class="search-close"
          aria-label="Close search"
        >
          &times;
        </button>
        <form id="search-form" class="search-form" role="search">
          <input
            id="search-input"
            type="search"
            name="q"
            placeholder="Search products, categories..."
            aria-label="Search"
            autocomplete="off"
          />
          <button type="submit" class="search-submit">Search</button>
        </form>
      </div>
    </div>
    <nav class="category-nav">
      <div class="category-container">
        <ul>
          <li><a href="categories.html?category=wall-art">Wall Art</a></li>
          <li>
            <a href="categories.html?category=wall-mirrors">Wall Mirrors</a>
          </li>
          <li>
            <a href="categories.html?category=wall-clocks">Wall Clocks</a>
          </li>
          <li>
            <a href="categories.html?category=name-plates">Name Plates</a>
          </li>
          <li>
            <a href="categories.html?category=photo-frames">Photo Frames</a>
          </li>
          <li><a href="categories.html?category=kids-decor">Kids Decor</a></li>
          <li><a href="categories.html?category=shelves">Shelves</a></li>
          <li><a href="categories.html?category=vases">Flower Vases</a></li>
        </ul>
      </div>
    </nav>

    <main>
      <section class="shop-products" style="padding: 2rem 1rem">
        <h2>Order Placed Successfully</h2>
        <div
          id="order-summary"
          style="
            max-width: 800px;
            margin: 1rem auto;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 1rem 1.25rem;
          "
        >
          <p>Fetching order details...</p>
        </div>
        <div style="text-align: center; margin-top: 1rem">
          <a class="shop-btn" href="shop.html">Continue Shopping</a>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-bottom">
        <p>&copy; 2025 Classic Decor. All Rights Reserved.</p>
      </div>
    </footer>

    <script src="cart.js"></script>
    <script src="script.js"></script>
    <script>
      (function () {
        var params = new URLSearchParams(window.location.search);
        var id = params.get("session_id");
        var cod = params.get("cod");
        var box = document.getElementById("order-summary");
        function fmt(n) {
          try {
            return "PKR " + Number(n).toFixed(0);
          } catch (_) {
            return n;
          }
        }
        function renderSummary(o) {
          box.innerHTML =
            "<p><strong>Name:</strong> " +
            (o.name || "") +
            "</p>" +
            "<p><strong>Phone:</strong> " +
            (o.phone || "") +
            "</p>" +
            "<p><strong>Address:</strong> " +
            (o.address || "") +
            "</p>" +
            "<p><strong>Items:</strong> " +
            (o.items || "") +
            "</p>" +
            (o.sizes ? "<p><strong>Sizes:</strong> " + o.sizes + "</p>" : "") +
            (o.colors
              ? "<p><strong>Colors:</strong> " + o.colors + "</p>"
              : "") +
            "<p><strong>Subtotal:</strong> " +
            fmt(o.subtotal) +
            "</p>" +
            "<p><strong>Shipping:</strong> " +
            fmt(o.shipping) +
            "</p>" +
            "<p><strong>Total:</strong> " +
            fmt(o.total) +
            "</p>";
          try {
            localStorage.setItem("cart", JSON.stringify([]));
            if (window.updateCartCount) window.updateCartCount();
            if (window.showMessage)
              window.showMessage("Order placed successfully!", "success");
          } catch (_) {}
          history.replaceState(null, "", window.location.pathname);
        }
        if (id) {
          fetch("/stripe-order?session_id=" + encodeURIComponent(id))
            .then(function (r) {
              return r.json();
            })
            .then(function (data) {
              if (data && data.payment_status === "paid")
                renderSummary(data.order || {});
              else box.textContent = "Payment not completed. Please try again.";
            })
            .catch(function () {
              box.textContent = "Unable to fetch order details.";
            });
        } else {
          try {
            var o = JSON.parse(localStorage.getItem("lastOrder") || "null");
            if (o) renderSummary(o);
            else box.textContent = "Order details unavailable.";
          } catch (_) {
            box.textContent = "Order details unavailable.";
          }
        }
      })();
    </script>
  </body>
</html>
